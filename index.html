<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flowchart from XML</title>
  <style>
    body { background-color: #121212; color: #f0f0f0; font-family: sans-serif; }
    svg { background-color: #1e1e1e; }
  </style>
</head>
<body>

<h2>Dynamic Flowchart from XML</h2>
<svg width="700" height="300"></svg>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  const svg = d3.select("svg");

  // Load XML file
  d3.xml("flowchart.xml").then(data => {
    const xmlNodes = data.documentElement.querySelectorAll("node");
    const xmlLinks = data.documentElement.querySelectorAll("link");

    // Convert XML nodes into JS objects
    const nodes = Array.from(xmlNodes).map(node => ({
      id: node.getAttribute("id"),
      x: +node.getAttribute("x"),
      y: +node.getAttribute("y"),
      info: node.getAttribute("info")
    }));

    const links = Array.from(xmlLinks).map(link => ({
      source: link.getAttribute("source"),
      target: link.getAttribute("target")
    }));

    // Draw links
    links.forEach(link => {
      const source = nodes.find(n => n.id === link.source);
      const target = nodes.find(n => n.id === link.target);

      svg.append("line")
        .attr("x1", source.x + 100)
        .attr("y1", source.y + 25)
        .attr("x2", target.x)
        .attr("y2", target.y + 25)
        .attr("stroke", "#f0f0f0")
        .attr("stroke-width", 2)
        .attr("marker-end", "url(#arrow)");
    });

    // Arrowhead marker
    svg.append("defs").append("marker")
      .attr("id", "arrow")
      .attr("viewBox", "0 0 10 10")
      .attr("refX", 10)
      .attr("refY", 5)
      .attr("markerWidth", 6)
      .attr("markerHeight", 6)
      .attr("orient", "auto")
      .append("path")
      .attr("d", "M 0 0 L 10 5 L 0 10 Z")
      .attr("fill", "#f0f0f0");

    // Draw nodes
    const nodeGroup = svg.selectAll(".node")
      .data(nodes)
      .enter()
      .append("g")
      .attr("class", "node")
      .attr("transform", d => `translate(${d.x},${d.y})`)
      .on("click", (event, d) => {
        alert(`${d.id}: ${d.info}`);
      });

    nodeGroup.append("rect")
      .attr("width", 100)
      .attr("height", 50)
      .attr("rx", 10)
      .attr("ry", 10)
      .attr("fill", "#4a90e2")
      .attr("stroke", "#888")
      .attr("stroke-width", 1);

    nodeGroup.append("text")
      .attr("x", 50)
      .attr("y", 30)
      .attr("text-anchor", "middle")
      .attr("fill", "#fff")
      .attr("font-size", "14px")
      .text(d => d.id);
  }).catch(err => {
    console.error("Error loading XML:", err);
  });
</script>

</body>
</html>
